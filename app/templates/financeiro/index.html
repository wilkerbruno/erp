{% extends "base.html" %}

{% block title %}Financeiro{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-dollar-sign me-2"></i>Dashboard Financeiro
        </h1>
        <div class="btn-group">
            <button class="btn btn-success" onclick="window.location.href='/financeiro/nova-transacao'">
                <i class="fas fa-plus me-1"></i>Nova Transação
            </button>
            <button class="btn btn-outline-primary" onclick="atualizarDados()">
                <i class="fas fa-sync me-1"></i>Atualizar
            </button>
        </div>
    </div>

    <!-- Cards de Resumo Financeiro -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Saldo Total
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">R$ 847.250,00</div>
                            <div class="small text-success">
                                <i class="fas fa-arrow-up me-1"></i>+15.2% vs mês anterior
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                A Receber (30 dias)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">R$ 324.580,00</div>
                            <div class="small text-info">
                                156 títulos em aberto
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-hand-holding-usd fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                A Pagar (30 dias)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">R$ 189.420,00</div>
                            <div class="small text-warning">
                                87 títulos pendentes
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-credit-card fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Resultado Mensal
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">R$ 135.160,00</div>
                            <div class="small text-success">
                                <i class="fas fa-arrow-up me-1"></i>Lucro de 18.5%
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-chart-pie fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Funcionalidades Principais -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-tachometer-alt me-2"></i>Funcionalidades Disponíveis
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-chart-bar fa-3x text-primary"></i>
                            </div>
                            <h5 class="card-title">DRE Gerencial</h5>
                            <p class="card-text text-muted">Demonstração completa do resultado do exercício</p>
                            <button class="btn btn-primary w-100" onclick="window.location.href='/financeiro/dre-gerencial'">
                                <i class="fas fa-arrow-right me-1"></i>Acessar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-credit-card fa-3x text-danger"></i>
                            </div>
                            <h5 class="card-title">Contas a Pagar</h5>
                            <p class="card-text text-muted">Gestão completa de pagamentos e fornecedores</p>
                            <button class="btn btn-danger w-100" onclick="window.location.href='/financeiro/contas-pagar'">
                                <i class="fas fa-arrow-right me-1"></i>Acessar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-hand-holding-usd fa-3x text-success"></i>
                            </div>
                            <h5 class="card-title">Contas a Receber</h5>
                            <p class="card-text text-muted">Controle de recebimentos e cobrança</p>
                            <button class="btn btn-success w-100" onclick="window.location.href='/financeiro/contas-receber'">
                                <i class="fas fa-arrow-right me-1"></i>Acessar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-plus-circle fa-3x text-info"></i>
                            </div>
                            <h5 class="card-title">Nova Transação</h5>
                            <p class="card-text text-muted">Criar nova conta a pagar ou receber</p>
                            <button class="btn btn-info w-100" onclick="window.location.href='/financeiro/nova-transacao'">
                                <i class="fas fa-plus me-1"></i>Criar Nova
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard de Gráficos -->
    <div class="row mb-4">
        <!-- Gráfico de Receitas vs Despesas -->
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Receitas vs Despesas</h6>
                </div>
                <div class="card-body">
                    <canvas id="receitasDespesasChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Gráfico de Fluxo de Caixa -->
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Fluxo de Caixa Mensal</h6>
                </div>
                <div class="card-body">
                    <canvas id="fluxoCaixaChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <!-- Gráfico de Despesas por Categoria -->
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Despesas por Categoria</h6>
                </div>
                <div class="card-body">
                    <canvas id="despesasCategoriaChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Gráfico de Evolução Patrimonial -->
        <div class="col-lg-6 col-md-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Evolução Patrimonial</h6>
                </div>
                <div class="card-body">
                    <canvas id="evolucaoPatrimonialChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Alertas e Próximos Vencimentos -->
    <div class="row">
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-white">
                    <h6 class="m-0 font-weight-bold">⚠️ Alertas Financeiros</h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1 text-danger">Títulos Vencidos</h6>
                                <p class="mb-1">23 títulos a receber vencidos</p>
                            </div>
                            <span class="badge bg-danger rounded-pill">R$ 45.280</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1 text-warning">Contas a Vencer Hoje</h6>
                                <p class="mb-1">8 contas com vencimento hoje</p>
                            </div>
                            <span class="badge bg-warning rounded-pill">R$ 12.450</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1 text-info">Fluxo Positivo</h6>
                                <p class="mb-1">Saldo projetado para 30 dias</p>
                            </div>
                            <span class="badge bg-info rounded-pill">R$ 89.340</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">Próximos Vencimentos</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descrição</th>
                                    <th>Valor</th>
                                    <th>Tipo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>08/08</td>
                                    <td>Fornecedor ABC Ltda</td>
                                    <td>R$ 8.450,00</td>
                                    <td><span class="badge bg-danger">Pagar</span></td>
                                </tr>
                                <tr>
                                    <td>09/08</td>
                                    <td>Cliente XYZ S/A</td>
                                    <td>R$ 15.200,00</td>
                                    <td><span class="badge bg-success">Receber</span></td>
                                </tr>
                                <tr>
                                    <td>10/08</td>
                                    <td>Aluguel Escritório</td>
                                    <td>R$ 3.800,00</td>
                                    <td><span class="badge bg-danger">Pagar</span></td>
                                </tr>
                                <tr>
                                    <td>10/08</td>
                                    <td>Vendas à Vista</td>
                                    <td>R$ 22.100,00</td>
                                    <td><span class="badge bg-success">Receber</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ações Rápidas -->
    <div class="card shadow">
        <div class="card-header">
            <h6 class="m-0 font-weight-bold text-primary">Ações Rápidas</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-success w-100" onclick="window.location.href='/financeiro/contas-receber'">
                        <i class="fas fa-plus-circle d-block mb-2"></i>
                        Nova Conta a Receber
                    </button>
                </div>
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-danger w-100" onclick="window.location.href='/financeiro/contas-pagar'">
                        <i class="fas fa-minus-circle d-block mb-2"></i>
                        Nova Conta a Pagar
                    </button>
                </div>
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-primary w-100" onclick="window.location.href='/financeiro/dre-gerencial'">
                        <i class="fas fa-chart-bar d-block mb-2"></i>
                        Ver DRE
                    </button>
                </div>
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-info w-100" onclick="window.location.href='/financeiro/conciliacao-bancaria'">
                        <i class="fas fa-university d-block mb-2"></i>
                        Conciliar Bancos
                    </button>
                </div>
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-warning w-100" onclick="window.location.href='/financeiro/relatorios-financeiros'">
                        <i class="fas fa-file-alt d-block mb-2"></i>
                        Gerar Relatório
                    </button>
                </div>
                <div class="col-md-2 mb-3">
                    <button class="btn btn-outline-secondary w-100" onclick="window.location.href='/financeiro/configuracoes'">
                        <i class="fas fa-cog d-block mb-2"></i>
                        Configurações
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Gráficos existentes mantidos
// Gráfico Receitas vs Despesas
const ctx1 = document.getElementById('receitasDespesasChart').getContext('2d');
const receitasDespesasChart = new Chart(ctx1, {
    type: 'bar',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'],
        datasets: [{
            label: 'Receitas',
            data: [450000, 520000, 480000, 580000, 620000, 590000, 650000, 680000],
            backgroundColor: 'rgba(40, 167, 69, 0.8)'
        }, {
            label: 'Despesas',
            data: [320000, 380000, 350000, 420000, 450000, 430000, 480000, 510000],
            backgroundColor: 'rgba(220, 53, 69, 0.8)'
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Gráfico Fluxo de Caixa
const ctx2 = document.getElementById('fluxoCaixaChart').getContext('2d');
const fluxoCaixaChart = new Chart(ctx2, {
    type: 'line',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'],
        datasets: [{
            label: 'Saldo',
            data: [100000, 130000, 160000, 140000, 170000, 190000, 210000, 170000],
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true
    }
});

// Gráfico Despesas por Categoria
const ctx3 = document.getElementById('despesasCategoriaChart').getContext('2d');
const despesasCategoriaChart = new Chart(ctx3, {
    type: 'doughnut',
    data: {
        labels: ['Fornecedores', 'Salários', 'Impostos', 'Despesas', 'Outros'],
        datasets: [{
            data: [40, 30, 15, 10, 5],
            backgroundColor: [
                '#dc3545',
                '#28a745',
                '#ffc107',
                '#17a2b8',
                '#6c757d'
            ]
        }]
    },
    options: {
        responsive: true
    }
});

// Gráfico Evolução Patrimonial
const ctx4 = document.getElementById('evolucaoPatrimonialChart').getContext('2d');
const evolucaoPatrimonialChart = new Chart(ctx4, {
    type: 'line',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'],
        datasets: [{
            label: 'Patrimônio Líquido',
            data: [800000, 820000, 850000, 870000, 890000, 920000, 940000, 960000],
            borderColor: 'rgba(40, 167, 69, 1)',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true
    }
});

// Funções corrigidas
function atualizarDados() {
    alert('Dados atualizados!');
    location.reload();
}

console.log('Dashboard Financeiro carregado com navegação funcional!');
</script>
{% endblock %}